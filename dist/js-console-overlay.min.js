class j{static setStyle(E,D){for(let H in D)E.style[H]=D[H]}static getCurrentTime(){const E=new Date;let D="";return D+=E.getHours().toString().padStart(2,"0"),D+=":",D+=E.getMinutes().toString().padStart(2,"0"),D+=":",D+=E.getSeconds().toString().padStart(2,"0"),D+=":",D+=E.getMilliseconds().toString().padStart(3,"0"),D}static formatData(E,D,H=0){let M="",X=[];if(Array.isArray(E)){M+="[";let $={type:"array",data:[]};for(let q of E){const F=this.formatData(q);M+=F[0]+", ",$.data.push(F[1])}X.push($),M+="]"}else if(typeof E==="object"){M+="{";let $={type:"object",data:[]};for(let q in E){if(E[q]instanceof Window||q==="window"||q==="view"||q.toLowerCase().includes("target")||q==="srcElement"||q==="toElement"||q==="view")continue;let F=this.formatData(E[q],"object",H+1);M+=`${q}: ${F[0]}, `,$.data.push({key:q,data:F[1]})}X.push($),M+="}"}else if(typeof E==="number"||typeof E==="bigint")M+=E.toString(),X.push({type:"number",data:E});else if(typeof E==="string"){if(E.toString().startsWith("function "))M+="__fn()";else M+=D==="object"?`"${E}"`:`${E}`;X.push({type:"string",data:E})}else if(typeof E==="boolean")M+=E?"true":"false";else if(typeof E==="function"){const $=E.toString();M+=!$.includes("native code ")?"__fn()":$}else console.info("I DONT KNOW",typeof E);return[M,X]}static formatUrl(E){return E.replace(location.protocol+"//","").replace(location.hostname,"")}static formatSize(E){if(E===0)return"0";let D=E.toString();const H=(M,X)=>{if(E>M)D=`${(E/M).toFixed(2)} ${X}`};return D=`${E} B`,H(1000,"KB"),H(1e6,"MB"),H(1e9,"GB"),D}}class G{createdAt;autohideModifier=0;container;element;#E=null;#H=null;#M=null;#D=null;constructor(E,...D){this.createdAt=Date.now(),this.container=document.createElement("div"),this.element=document.createElement("div"),this.container.appendChild(this.element),this.setBannerStyle(),this.setLogStyle(E),this.setText(E,...D)}changeStyle(E){this.setLogStyle(E)}addText(...E){this.element.innerHTML+=" "+this.generateText(...E)}generateText(...E){let D=[];for(let H of E){const M=j.formatData(H);D.push(M[0])}return D.join(" ")}setText(E,...D){let H=[j.getCurrentTime(),this.generateText(...D)];this.element.innerHTML=H.join(" ")}setBannerStyle(){j.setStyle(this.container,{display:"flex",flexDirection:"column",width:"fit-content",padding:"0px 8px",borderRadius:"2px"}),j.setStyle(this.element,{display:"flex",alignItems:"center",flexWrap:"wrap",width:"fit-content",transition:"all 0.2s ease-out",gap:"4px"})}setLogStyle(E){let D={};switch(E){case"web-success":D.background="#33aa11";break;case"web-pending":D.background="#4411aa";break;case"log":D.background="#4444cc";break;case"debug":D.background="#777777";break;case"info":D.background="#ffffff",D.color="#000000";break;case"warn":D.background="#998822";break;case"error":case"web-error":D.background="#991111";break;default:break}j.setStyle(this.element,D),j.setStyle(this.container,D)}setStackTrace(E){const D=document.createElement("div");j.setStyle(D,{marginLeft:"10px",fontWeight:"bold"});for(let H of E)D.innerHTML+=`<div>\u2022 ${H}</div>`;this.container.appendChild(D)}setWebProgress(E,D,H){if(this.#M.style.width=E.toString().padStart(3,"0")+"%",this.#H.innerHTML=E+"%",D&&H)if(E===100)this.#D.innerHTML=`(${j.formatSize(D)})`;else this.#D.innerHTML=`(${j.formatSize(H)} / ${j.formatSize(D)})`}createWebProgressDiv(){this.#E=document.createElement("div"),j.setStyle(this.#E,{display:"flex",alignItems:"center",gap:"5px"});const E=document.createElement("div");E.innerHTML="50";const D=document.createElement("div");j.setStyle(D,{display:"block",backgroundColor:"",border:"1px solid white",height:"8px",width:"100px",borderRadius:"2px"});const H=document.createElement("div");j.setStyle(H,{height:"inherit",width:"0px",backgroundColor:"white",transition:"width 0.2s linear",borderRadius:"inherit"}),D.appendChild(H),this.#E.appendChild(D),this.#E.appendChild(E),this.#D=document.createElement("div"),this.#E.appendChild(this.#D),this.#H=E,this.#M=H,this.element.appendChild(this.#E)}}class J{isMouseOver=!1;containerElement=void 0;messages=[];options={maxMessage:100,autohideDelay:10,position:"BOTTOM-LEFT",offsetX:20,offsetY:40,maxHeight:200,maxWidth:0,opacity:0.8};constructor(){this.show(),this.overrideConsole("log"),this.overrideConsole("debug"),this.overrideConsole("info"),this.overrideConsole("warn"),this.overrideConsole("error"),window.onerror=(E,D,H,M,X)=>{const $=this.showLog("error",X?.message,X?.cause);if(X?.stack){const q=X.stack.split("\n").filter((F)=>F)??[];$.setStackTrace(q)}},window.onunhandledrejection=(E)=>{const D=this.showLog("error",E?.type,E.reason?.message);if(E.reason?.stack){const H=E.reason.stack.split("\n").filter((M)=>M)??[];D.setStackTrace(H)}},this.overrideFetch(),this.overrideXmlHttpRequest()}setOptions(E){this.options={...this.options,...E},document.body.removeChild(this.containerElement),this.show()}show(){this.containerElement=this.createContainerElement()}overrideFetch(){const E=this;window.fetch=new Proxy(window.fetch,{async apply(D,H,M){const X=M[0],$=E.showLog("web-pending",X.method,j.formatUrl(X.url??X)),q=Date.now();let F=await D.apply(H,M);const I=Date.now()-q;if(!F.ok){const K=await F.clone().text();$.changeStyle("web-error"),$.addText(`[${F.status} ${F.statusText}]`,`[${I}ms]`,K)}else $.changeStyle("web-success"),$.addText(`[${F.status}]`,`[${I}ms]`);return F}})}overrideXmlHttpRequest(){const E=this;XMLHttpRequest.prototype.open=new Proxy(XMLHttpRequest.prototype.open,{apply(D,H,M){D.apply(H,M);const X=E.showLog("web-pending",M[0],j.formatUrl(M[1]));if(M[0]==="POST")X.createWebProgressDiv(),H.upload.addEventListener("progress",($)=>{X.setWebProgress(Math.round($.loaded/$.total*100),$.total,$.loaded),X.autohideModifier+=1000})}})}overrideConsole(E){const D=this;console[E]=new Proxy(console[E],{apply(H,M,X){H.apply(M,X);const $=D.showLog(E,...X);if(E==="error"){const q=Error().stack?.split("\n").filter((F)=>F)??[];$.setStackTrace(q)}}})}createContainerElement(){const E=document.createElement("div");E.id="console-overlay-container";const D={"BOTTOM-LEFT":{bottom:this.options.offsetY+"px",left:this.options.offsetX+"px",flexDirection:"column-reverse"},"TOP-LEFT":{top:this.options.offsetY+"px",left:this.options.offsetX+"px",flexDirection:"column"},"BOTTOM-RIGHT":{bottom:this.options.offsetY+"px",right:this.options.offsetX+"px",flexDirection:"column-reverse"},"TOP-RIGHT":{top:this.options.offsetY+"px",right:this.options.offsetX+"px",flexDirection:"column"}};return j.setStyle(E,{position:"absolute",display:"flex",gap:"2px",borderRadius:"5px",maxHeight:this.options.maxHeight+"px",overflow:"auto",zIndex:"30000",maxWidth:this.options.maxWidth>10?`${this.options.maxWidth}px`:`calc(100vw - ${this.options.offsetX*2}px)`,opacity:Math.max(0,Math.min(1,this.options.opacity)),fontSize:"0.65rem",fontFamily:"monospace",...D[this.options.position]}),E.addEventListener("mouseenter",()=>{this.isMouseOver=!0}),E.addEventListener("mouseleave",()=>{this.isMouseOver=!1}),this.autohide(),document.body.appendChild(E),E}autohide(){setInterval(()=>{const E=Date.now();for(let D of this.messages)try{if(this.isMouseOver){D.autohideModifier+=1000;continue}if(E-(D.createdAt+D.autohideModifier)>this.options.autohideDelay*1000)this.containerElement.removeChild(D.container),this.messages=this.messages.filter((H)=>H!==D)}catch(H){}},1000)}showLog(E,...D){const H=new G(E,...D);if(this.containerElement.insertBefore(H.container,this.containerElement.firstChild),this.messages.push(H),this.messages.length>=this.options.maxMessage)this.messages=this.messages.slice(-this.options.maxMessage);return H}}Object.assign(window,{overlayConsole:new J});
