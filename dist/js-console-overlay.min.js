class X{static setStyle(H,E){for(let w in E)H.style[w]=E[w]}static getCurrentTime(){const H=new Date;let E="";return E+=H.getHours().toString().padStart(2,"0"),E+=":",E+=H.getMinutes().toString().padStart(2,"0"),E+=":",E+=H.getSeconds().toString().padStart(2,"0"),E+=":",E+=H.getMilliseconds().toString().padStart(3,"0"),E}static formatData(H,E,w=0){let D="",L=[];if(Array.isArray(H)){D+="[";let M={type:"array",data:[]};for(let Y of H){const $=this.formatData(Y);D+=$[0]+", ",M.data.push($[1])}L.push(M),D+="]"}else if(typeof H==="object"){D+="{";let M={type:"object",data:[]};for(let Y in H){if(H[Y]instanceof Window||Y==="window"||Y==="view"||Y.toLowerCase().includes("target")||Y==="srcElement"||Y==="toElement"||Y==="view")continue;let $=this.formatData(H[Y],"object",w+1);D+=`${Y}: ${$[0]}, `,M.data.push({key:Y,data:$[1]})}L.push(M),D+="}"}else if(typeof H==="number"||typeof H==="bigint")D+=H.toString(),L.push({type:"number",data:H});else if(typeof H==="string"){if(H.toString().startsWith("function "))D+="__fn()";else D+=E==="object"?`"${H}"`:`${H}`;L.push({type:"string",data:H})}else if(typeof H==="boolean")D+=H?"true":"false";else if(typeof H==="function"){const M=H.toString();D+=!M.includes("native code ")?"__fn()":M}else console.info("I DONT KNOW",typeof H);return[D,L]}static formatUrl(H){return H.replace(location.protocol+"//","").replace(location.hostname,"")}static formatSize(H){if(H===0)return"0";let E=H.toString();const w=(D,L)=>{if(H>D)E=`${(H/D).toFixed(2)} ${L}`};return E=`${H} B`,w(1000,"KB"),w(1e6,"MB"),w(1e9,"GB"),E}}class j{createdAt;autohideModifier=0;container;element;#H=null;#w=null;#D=null;#E=null;constructor(H,...E){this.createdAt=Date.now(),this.container=document.createElement("div"),this.element=document.createElement("div"),this.container.appendChild(this.element),this.setBannerStyle(),this.setLogStyle(H),this.setText(H,...E)}changeStyle(H){this.setLogStyle(H)}addText(...H){this.element.innerHTML+=" "+this.generateText(...H)}generateText(...H){let E=[];for(let w of H){const D=X.formatData(w);E.push(D[0])}return E.join(" ")}setText(H,...E){let w=[X.getCurrentTime(),this.generateText(...E)];this.element.innerHTML=w.join(" ")}setBannerStyle(){X.setStyle(this.container,{display:"flex",flexDirection:"column",width:"fit-content",padding:"0px 8px",borderRadius:"2px"}),X.setStyle(this.element,{display:"flex",alignItems:"center",flexWrap:"wrap",width:"fit-content",transition:"all 0.2s ease-out",gap:"4px"})}setLogStyle(H){let E={};switch(H){case"web-success":E.background="#33aa11";break;case"web-pending":E.background="#4411aa";break;case"log":E.background="#4444cc";break;case"debug":E.background="#777777";break;case"info":E.background="#ffffff",E.color="#000000";break;case"warn":E.background="#998822";break;case"error":case"web-error":E.background="#991111";break;default:break}X.setStyle(this.element,E),X.setStyle(this.container,E)}setStackTrace(H){const E=document.createElement("div");X.setStyle(E,{marginLeft:"10px",fontWeight:"bold"});for(let w of H)E.innerHTML+=`<div>\u2022 ${w}</div>`;this.container.appendChild(E)}setWebProgress(H,E,w){if(this.#D.style.width=H.toString().padStart(3,"0")+"%",this.#w.innerHTML=H+"%",E&&w)if(H===100)this.#E.innerHTML=`(${X.formatSize(E)})`;else this.#E.innerHTML=`(${X.formatSize(w)} / ${X.formatSize(E)})`}createWebProgressDiv(){this.#H=document.createElement("div"),X.setStyle(this.#H,{display:"flex",alignItems:"center",gap:"5px"});const H=document.createElement("div");H.innerHTML="50";const E=document.createElement("div");X.setStyle(E,{display:"block",backgroundColor:"",border:"1px solid white",height:"8px",width:"100px",borderRadius:"2px"});const w=document.createElement("div");X.setStyle(w,{height:"inherit",width:"0px",backgroundColor:"white",transition:"width 0.2s linear",borderRadius:"inherit"}),E.appendChild(w),this.#H.appendChild(E),this.#H.appendChild(H),this.#E=document.createElement("div"),this.#H.appendChild(this.#E),this.#w=H,this.#D=w,this.element.appendChild(this.#H)}}class F{isMouseOver=!1;containerElement=void 0;messages=[];options={maxMessage:100,autohideDelay:10,position:"BOTTOM-LEFT",offsetX:20,offsetY:40,maxHeight:200,maxWidth:0,opacity:0.8};constructor(){this.show(),this.overrideConsole("log"),this.overrideConsole("debug"),this.overrideConsole("info"),this.overrideConsole("warn"),this.overrideConsole("error"),window.onerror=(H,E,w,D,L)=>{this.showLog("error",L?.message,L?.cause,L?.stack)},window.onunhandledrejection=(H)=>{const E=this.showLog("error",H?.type,H.reason?.message);if(H.reason?.stack){const w=H.reason.stack.split("\n").filter((D)=>D)??[];E.setStackTrace(w)}},this.overrideFetch(),this.overrideXmlHttpRequest()}setOptions(H){this.options={...this.options,...H},document.body.removeChild(this.containerElement),this.show()}show(){this.containerElement=this.createContainerElement()}overrideFetch(){const H=this;window.fetch=new Proxy(window.fetch,{async apply(E,w,D){const L=D[0],M=H.showLog("web-pending",L.method,X.formatUrl(L.url??L)),Y=Date.now();let $=await E.apply(w,D);const q=Date.now()-Y;if(!$.ok){const G=await $.clone().text();M.changeStyle("web-error"),M.addText(`[${$.status} ${$.statusText}]`,`[${q}ms]`,G)}else M.changeStyle("web-success"),M.addText(`[${$.status}]`,`[${q}ms]`);return $}})}overrideXmlHttpRequest(){const H=this;XMLHttpRequest.prototype.open=new Proxy(XMLHttpRequest.prototype.open,{apply(E,w,D){E.apply(w,D);const L=H.showLog("web-pending",D[0],X.formatUrl(D[1]));if(D[0]==="POST")L.createWebProgressDiv(),w.upload.addEventListener("progress",(M)=>{L.setWebProgress(Math.round(M.loaded/M.total*100),M.total,M.loaded),L.autohideModifier+=1000})}})}overrideConsole(H){const E=this;console[H]=new Proxy(console[H],{apply(w,D,L){w.apply(D,L);const M=E.showLog(H,...L);if(H==="error"){const Y=Error().stack?.split("\n").filter(($)=>$)??[];M.setStackTrace(Y)}}})}createContainerElement(){const H=document.createElement("div");H.id="console-overlay-container";const E={"BOTTOM-LEFT":{bottom:this.options.offsetY+"px",left:this.options.offsetX+"px",flexDirection:"column-reverse"},"TOP-LEFT":{top:this.options.offsetY+"px",left:this.options.offsetX+"px",flexDirection:"column"},"BOTTOM-RIGHT":{bottom:this.options.offsetY+"px",right:this.options.offsetX+"px",flexDirection:"column-reverse"},"TOP-RIGHT":{top:this.options.offsetY+"px",right:this.options.offsetX+"px",flexDirection:"column"}};return X.setStyle(H,{position:"absolute",display:"flex",gap:"2px",borderRadius:"5px",maxHeight:this.options.maxHeight+"px",overflow:"auto",zIndex:"30000",maxWidth:this.options.maxWidth>10?`${this.options.maxWidth}px`:`calc(100vw - ${this.options.offsetX*2}px)`,opacity:Math.max(0,Math.min(1,this.options.opacity)),fontSize:"0.65rem",fontFamily:"monospace",...E[this.options.position]}),H.addEventListener("mouseenter",()=>{this.isMouseOver=!0}),H.addEventListener("mouseleave",()=>{this.isMouseOver=!1}),this.autohide(),document.body.appendChild(H),H}autohide(){setInterval(()=>{const H=Date.now();for(let E of this.messages)try{if(this.isMouseOver){E.autohideModifier+=1000;continue}if(H-(E.createdAt+E.autohideModifier)>this.options.autohideDelay*1000)this.containerElement.removeChild(E.container),this.messages=this.messages.filter((w)=>w!==E)}catch(w){}},1000)}showLog(H,...E){const w=new j(H,...E);if(this.containerElement.insertBefore(w.container,this.containerElement.firstChild),this.messages.push(w),this.messages.length>=this.options.maxMessage)this.messages=this.messages.slice(-this.options.maxMessage);return w}}Object.assign(window,{overlayConsole:new F});
