class D{static setStyle(H,E){for(let X in E)H.style[X]=E[X]}static getCurrentTime(){const H=new Date;let E="";return E+=H.getHours().toString().padStart(2,"0"),E+=":",E+=H.getMinutes().toString().padStart(2,"0"),E+=":",E+=H.getSeconds().toString().padStart(2,"0"),E+=":",E+=H.getMilliseconds().toString().padStart(3,"0"),E}static formatData(H,E,X=0){let $="",j=[];if(Array.isArray(H)){$+="[";let q={type:"array",data:[]};for(let F of H){const G=this.formatData(F);$+=G[0]+", ",q.data.push(G[1])}j.push(q),$+="]"}else if(typeof H==="object"){$+="{";let q={type:"object",data:[]};for(let F in H){if(H[F]instanceof Window||F==="window"||F==="view"||F.toLowerCase().includes("target")||F==="srcElement"||F==="toElement"||F==="view")continue;let G=this.formatData(H[F],"object",X+1);$+=`${F}: ${G[0]}, `,q.data.push({key:F,data:G[1]})}j.push(q),$+="}"}else if(typeof H==="number"||typeof H==="bigint")$+=H.toString(),j.push({type:"number",data:H});else if(typeof H==="string"){if(H.toString().startsWith("function "))$+="__fn()";else $+=E==="object"?`"${H}"`:`${H}`;j.push({type:"string",data:H})}else if(typeof H==="boolean")$+=H?"true":"false";else if(typeof H==="function"){const q=H.toString();$+=!q.includes("native code ")?"__fn()":q}else console.info("I DONT KNOW",typeof H);return[$,j]}static formatUrl(H){return H.replace(location.protocol+"//","").replace(location.hostname,"")}static formatSize(H){if(H===0)return"0";let E=H.toString();const X=($,j)=>{if(H>$)E=`${(H/$).toFixed(2)} ${j}`};return E=`${H} B`,X(1000,"KB"),X(1e6,"MB"),X(1e9,"GB"),E}}class I{createdAt;autohideModifier=0;container;element;#H=null;#X=null;#$=null;#E=null;constructor(H,...E){this.createdAt=Date.now(),this.container=document.createElement("div"),this.element=document.createElement("div"),this.container.appendChild(this.element),this.setBannerStyle(),this.setLogStyle(H),this.setText(H,...E)}changeStyle(H){this.setLogStyle(H)}addText(...H){this.element.innerHTML+=" "+this.generateText(...H)}generateText(...H){let E=[];for(let X of H){const $=D.formatData(X);E.push($[0])}return E.join(" ")}setText(H,...E){let X=[D.getCurrentTime(),this.generateText(...E)];this.element.innerHTML=X.join(" ")}setBannerStyle(){D.setStyle(this.container,{display:"flex",flexDirection:"column",width:"fit-content",padding:"0px 8px",borderRadius:"2px",color:"white"}),D.setStyle(this.element,{display:"flex",alignItems:"center",flexWrap:"wrap",width:"fit-content",transition:"all 0.2s ease-out",gap:"4px"})}setLogStyle(H){let E={};switch(H){case"web-success":E.background="#33aa11";break;case"web-pending":E.background="#4411aa";break;case"log":E.background="#4444cc";break;case"debug":E.background="#777777";break;case"info":E.background="#ffffff",E.color="#000000";break;case"warn":E.background="#998822";break;case"error":case"web-error":E.background="#991111";break;default:break}D.setStyle(this.element,E),D.setStyle(this.container,E)}setStackTrace(H){const E=document.createElement("div");D.setStyle(E,{marginLeft:"10px",fontWeight:"bold"});for(let X of H)E.innerHTML+=`<div>\u2022 ${X}</div>`;this.container.appendChild(E)}setWebProgress(H,E,X){if(this.#$.style.width=H.toString().padStart(3,"0")+"%",this.#X.innerHTML=H+"%",E&&X)if(H===100)this.#E.innerHTML=`(${D.formatSize(E)})`;else this.#E.innerHTML=`(${D.formatSize(X)} / ${D.formatSize(E)})`}createWebProgressDiv(){this.#H=document.createElement("div"),D.setStyle(this.#H,{display:"flex",alignItems:"center",gap:"5px"});const H=document.createElement("div");H.innerHTML="50";const E=document.createElement("div");D.setStyle(E,{display:"block",backgroundColor:"",border:"1px solid white",height:"8px",width:"100px",borderRadius:"2px"});const X=document.createElement("div");D.setStyle(X,{height:"inherit",width:"0px",backgroundColor:"white",transition:"width 0.2s linear",borderRadius:"inherit"}),E.appendChild(X),this.#H.appendChild(E),this.#H.appendChild(H),this.#E=document.createElement("div"),this.#H.appendChild(this.#E),this.#X=H,this.#$=X,this.element.appendChild(this.#H)}}class K{isMouseOver=!1;containerElement=void 0;messages=[];options={maxMessage:100,autohideDelay:10,position:"BOTTOM-LEFT",offsetX:20,offsetY:40,maxHeight:200,maxWidth:0,opacity:0.8};constructor(){this.show(),this.overrideConsole("log"),this.overrideConsole("debug"),this.overrideConsole("info"),this.overrideConsole("warn"),this.overrideConsole("error"),window.onerror=(H,E,X,$,j)=>{const q=this.showLog("error",j?.message,j?.cause);if(j?.stack){const F=j.stack.split("\n").filter((G)=>G)??[];q.setStackTrace(F)}},window.onunhandledrejection=(H)=>{const E=this.showLog("error",H?.type,H.reason?.message);if(H.reason?.stack){const X=H.reason.stack.split("\n").filter(($)=>$)??[];E.setStackTrace(X)}},this.overrideFetch(),this.overrideXmlHttpRequest()}setOptions(H){this.options={...this.options,...H},document.body.removeChild(this.containerElement),this.show()}show(){this.containerElement=this.createContainerElement()}overrideFetch(){const H=this;window.fetch=new Proxy(window.fetch,{async apply(E,X,$){const j=$[0],q=H.showLog("web-pending",j.method,D.formatUrl(j.url??j)),F=Date.now();let G=await E.apply(X,$);const J=Date.now()-F;if(!G.ok){const L=await G.clone().text();q.changeStyle("web-error"),q.addText(`[${G.status} ${G.statusText}]`,`[${J}ms]`,L)}else q.changeStyle("web-success"),q.addText(`[${G.status}]`,`[${J}ms]`);return G}})}overrideXmlHttpRequest(){const H=this;XMLHttpRequest.prototype.open=new Proxy(XMLHttpRequest.prototype.open,{apply(E,X,$){E.apply(X,$);const j=H.showLog("web-pending",$[0],D.formatUrl($[1]));if($[0]==="POST")j.createWebProgressDiv(),X.upload.addEventListener("progress",(q)=>{j.setWebProgress(Math.round(q.loaded/q.total*100),q.total,q.loaded),j.autohideModifier+=1000})}})}overrideConsole(H){const E=this;console[H]=new Proxy(console[H],{apply(X,$,j){X.apply($,j);const q=E.showLog(H,...j);if(H==="error"){const F=Error().stack?.split("\n").filter((G)=>G)??[];q.setStackTrace(F)}}})}createContainerElement(){const H=document.createElement("div");H.id="console-overlay-container";const E={"BOTTOM-LEFT":{bottom:this.options.offsetY+"px",left:this.options.offsetX+"px",flexDirection:"column-reverse"},"TOP-LEFT":{top:this.options.offsetY+"px",left:this.options.offsetX+"px",flexDirection:"column"},"BOTTOM-RIGHT":{bottom:this.options.offsetY+"px",right:this.options.offsetX+"px",flexDirection:"column-reverse"},"TOP-RIGHT":{top:this.options.offsetY+"px",right:this.options.offsetX+"px",flexDirection:"column"}};return D.setStyle(H,{position:"absolute",display:"flex",gap:"2px",borderRadius:"5px",maxHeight:this.options.maxHeight+"px",overflow:"auto",zIndex:"30000",maxWidth:this.options.maxWidth>10?`${this.options.maxWidth}px`:`calc(100vw - ${this.options.offsetX*2}px)`,opacity:Math.max(0,Math.min(1,this.options.opacity)),fontSize:"0.65rem",fontFamily:"monospace",...E[this.options.position]}),H.addEventListener("mouseenter",()=>{this.isMouseOver=!0}),H.addEventListener("mouseleave",()=>{this.isMouseOver=!1}),this.autohide(),document.body.appendChild(H),H}autohide(){setInterval(()=>{const H=Date.now();for(let E of this.messages)try{if(this.isMouseOver){E.autohideModifier+=1000;continue}if(H-(E.createdAt+E.autohideModifier)>this.options.autohideDelay*1000)this.containerElement.removeChild(E.container),this.messages=this.messages.filter((X)=>X!==E)}catch(X){}},1000)}showLog(H,...E){const X=new I(H,...E);if(this.containerElement.insertBefore(X.container,this.containerElement.firstChild),this.messages.push(X),this.messages.length>=this.options.maxMessage)this.messages=this.messages.slice(-this.options.maxMessage);return X}}Object.assign(window,{overlayConsole:new K});
