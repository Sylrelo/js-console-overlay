class j{static setStyle(M,D){for(let E in D)M.style[E]=D[E]}static getCurrentTime(){const M=new Date;let D="";return D+=M.getHours().toString().padStart(2,"0"),D+=":",D+=M.getMinutes().toString().padStart(2,"0"),D+=":",D+=M.getSeconds().toString().padStart(2,"0"),D+=":",D+=M.getMilliseconds().toString().padStart(3,"0"),D}static formatData(M,D,E=0){let H="",X=[];if(Array.isArray(M)){H+="[";let $={type:"array",data:[]};for(let q of M){const w=this.formatData(q);H+=w[0]+", ",$.data.push(w[1])}X.push($),H+="]"}else if(typeof M==="object"){H+="{";let $={type:"object",data:[]};for(let q in M){if(M[q]instanceof Window||q==="window"||q==="view"||q.toLowerCase().includes("target")||q==="srcElement"||q==="toElement"||q==="view")continue;let w=this.formatData(M[q],"object",E+1);H+=`${q}: ${w[0]}, `,$.data.push({key:q,data:w[1]})}X.push($),H+="}"}else if(typeof M==="number"||typeof M==="bigint")H+=M.toString(),X.push({type:"number",data:M});else if(typeof M==="string"){if(M.toString().startsWith("function "))H+="__fn()";else H+=D==="object"?`"${M}"`:`${M}`;X.push({type:"string",data:M})}else if(typeof M==="boolean")H+=M?"true":"false";else if(typeof M==="function"){const $=M.toString();H+=!$.includes("native code ")?"__fn()":$}else console.info("I DONT KNOW",typeof M);return[H,X]}static formatUrl(M){return M.replace(location.protocol+"//","").replace(location.hostname,"")}static formatSize(M){if(M===0)return"0";let D=M.toString();const E=(H,X)=>{if(M>H)D=`${(M/H).toFixed(2)} ${X}`};return D=`${M} B`,E(1000,"KB"),E(1e6,"MB"),E(1e9,"GB"),D}}class F{createdAt;autohideModifier=0;container;element;#M=null;#E=null;#H=null;#D=null;constructor(M,...D){this.createdAt=Date.now(),this.container=document.createElement("div"),this.element=document.createElement("div"),this.container.appendChild(this.element),this.setBannerStyle(),this.setLogStyle(M),this.setText(M,...D)}changeStyle(M){this.setLogStyle(M)}addText(...M){this.element.innerHTML+=" "+this.generateText(...M)}generateText(...M){let D=[];for(let E of M){const H=j.formatData(E);D.push(H[0])}return D.join(" ")}setText(M,...D){let E=[j.getCurrentTime(),this.generateText(...D)];this.element.innerHTML=E.join(" ")}setBannerStyle(){j.setStyle(this.container,{display:"flex",flexDirection:"column",width:"fit-content",padding:"0px 8px",borderRadius:"2px"}),j.setStyle(this.element,{display:"flex",alignItems:"center",flexWrap:"wrap",width:"fit-content",transition:"all 0.2s ease-out",gap:"4px"})}setLogStyle(M){let D={};switch(M){case"web-success":D.background="#33aa11";break;case"web-pending":D.background="#4411aa";break;case"log":D.background="#4444cc";break;case"debug":D.background="#777777";break;case"info":D.background="#ffffff",D.color="#000000";break;case"warn":D.background="#998822";break;case"error":case"web-error":D.background="#991111";break;default:break}j.setStyle(this.element,D),j.setStyle(this.container,D)}setStackTrace(M){const D=document.createElement("div");j.setStyle(D,{marginLeft:"10px",fontWeight:"bold"});for(let E of M)D.innerHTML+=`<div>\u2022 ${E}</div>`;this.container.appendChild(D)}setWebProgress(M,D,E){if(this.#H.style.width=M.toString().padStart(3,"0")+"%",this.#E.innerHTML=M+"%",D&&E)if(M===100)this.#D.innerHTML=`(${j.formatSize(D)})`;else this.#D.innerHTML=`(${j.formatSize(E)} / ${j.formatSize(D)})`}createWebProgressDiv(){this.#M=document.createElement("div"),j.setStyle(this.#M,{display:"flex",alignItems:"center",gap:"5px"});const M=document.createElement("div");M.innerHTML="50";const D=document.createElement("div");j.setStyle(D,{display:"block",backgroundColor:"",border:"1px solid white",height:"8px",width:"100px",borderRadius:"2px"});const E=document.createElement("div");j.setStyle(E,{height:"inherit",width:"0px",backgroundColor:"white",transition:"width 0.2s linear",borderRadius:"inherit"}),D.appendChild(E),this.#M.appendChild(D),this.#M.appendChild(M),this.#D=document.createElement("div"),this.#M.appendChild(this.#D),this.#E=M,this.#H=E,this.element.appendChild(this.#M)}}class I{isMouseOver=!1;containerElement=void 0;messages=[];options={maxMessage:100,autohideDelay:10,position:"BOTTOM-LEFT",offsetX:20,offsetY:40,maxHeight:200,maxWidth:0,opacity:0.8};constructor(){this.show(),this.overrideConsole("log"),this.overrideConsole("debug"),this.overrideConsole("info"),this.overrideConsole("warn"),this.overrideConsole("error"),window.onerror=(M,D,E,H,X)=>{this.showLog("error",X?.message,X?.cause,X?.stack)},window.onunhandledrejection=(M)=>{const D=this.showLog("error",M?.type,M.reason?.message);if(M.reason?.stack){const E=M.reason.stack.split("\n").filter((H)=>H)??[];D.setStackTrace(E)}},this.overrideFetch(),this.overrideXmlHttpRequest()}setOptions(M){this.options={...this.options,...M},document.body.removeChild(this.containerElement),this.show()}show(){this.containerElement=this.createContainerElement()}overrideFetch(){const M=this;window.fetch=new Proxy(window.fetch,{async apply(D,E,H){const X=H[0],$=M.showLog("web-pending",X.method,j.formatUrl(X.url)),q=Date.now();let w=await D.apply(E,H);const G=Date.now()-q;if(!w.ok){const J=await w.clone().text();$.changeStyle("web-error"),$.addText(`[${w.status} ${w.statusText}]`,`[${G}ms]`,J)}else $.changeStyle("web-success"),$.addText(`[${w.status}]`,`[${G}ms]`);return w}})}overrideXmlHttpRequest(){const M=this;XMLHttpRequest.prototype.open=new Proxy(XMLHttpRequest.prototype.open,{apply(D,E,H){D.apply(E,H);const X=M.showLog("web-pending",H[0],j.formatUrl(H[1]));if(H[0]==="POST")X.createWebProgressDiv(),E.upload.addEventListener("progress",($)=>{X.setWebProgress(Math.round($.loaded/$.total*100),$.total,$.loaded),X.autohideModifier+=1000})}})}overrideConsole(M){const D=this;console[M]=new Proxy(console[M],{apply(E,H,X){E.apply(H,X);const $=D.showLog(M,...X);if(M==="error"){const q=Error().stack?.split("\n").filter((w)=>w)??[];$.setStackTrace(q)}}})}createContainerElement(){const M=document.createElement("div");M.id="console-overlay-container";const D={"BOTTOM-LEFT":{bottom:this.options.offsetY+"px",left:this.options.offsetX+"px",flexDirection:"column-reverse"},"TOP-LEFT":{top:this.options.offsetY+"px",left:this.options.offsetX+"px",flexDirection:"column"},"BOTTOM-RIGHT":{bottom:this.options.offsetY+"px",right:this.options.offsetX+"px",flexDirection:"column-reverse"},"TOP-RIGHT":{top:this.options.offsetY+"px",right:this.options.offsetX+"px",flexDirection:"column"}};return j.setStyle(M,{position:"absolute",display:"flex",gap:"2px",borderRadius:"5px",maxHeight:this.options.maxHeight+"px",overflow:"auto",zIndex:"30000",maxWidth:this.options.maxWidth>10?`${this.options.maxWidth}px`:`calc(100vw - ${this.options.offsetX*2}px)`,opacity:Math.max(0,Math.min(1,this.options.opacity)),fontSize:"0.65rem",fontFamily:"monospace",...D[this.options.position]}),M.addEventListener("mouseenter",()=>{this.isMouseOver=!0}),M.addEventListener("mouseleave",()=>{this.isMouseOver=!1}),this.autohide(),document.body.appendChild(M),M}autohide(){setInterval(()=>{const M=Date.now();for(let D of this.messages)try{if(this.isMouseOver){D.autohideModifier+=1000;continue}if(M-(D.createdAt+D.autohideModifier)>this.options.autohideDelay*1000)this.containerElement.removeChild(D.container),this.messages=this.messages.filter((E)=>E!==D)}catch(E){}},1000)}showLog(M,...D){const E=new F(M,...D);if(this.containerElement.insertBefore(E.container,this.containerElement.firstChild),this.messages.push(E),this.messages.length>=this.options.maxMessage)this.messages=this.messages.slice(-this.options.maxMessage);return E}}Object.assign(window,{overlayConsole:new I});
