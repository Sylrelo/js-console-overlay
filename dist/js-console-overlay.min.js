class L{static setStyle(D,E){for(let H in E)D.style[H]=E[H]}static getCurrentTime(){const D=new Date;let E="";return E+=D.getHours().toString().padStart(2,"0"),E+=":",E+=D.getMinutes().toString().padStart(2,"0"),E+=":",E+=D.getSeconds().toString().padStart(2,"0"),E+=":",E+=D.getMilliseconds().toString().padStart(3,"0"),E}static formatData(D,E,H=0){let M="",j=[];if(Array.isArray(D)){M+="[";let w={type:"array",data:[]};for(let X of D){const $=this.formatData(X);M+=$[0]+", ",w.data.push($[1])}j.push(w),M+="]"}else if(typeof D==="object"){M+="{";let w={type:"object",data:[]};for(let X in D){if(D[X]instanceof Window||X==="window"||X==="view"||X.toLowerCase().includes("target")||X==="srcElement"||X==="toElement"||X==="view")continue;let $=this.formatData(D[X],"object",H+1);M+=`${X}: ${$[0]}, `,w.data.push({key:X,data:$[1]})}j.push(w),M+="}"}else if(typeof D==="number"||typeof D==="bigint")M+=D.toString(),j.push({type:"number",data:D});else if(typeof D==="string"){if(D.toString().startsWith("function "))M+="__fn()";else M+=E==="object"?`"${D}"`:`${D}`;j.push({type:"string",data:D})}else if(typeof D==="boolean")M+=D?"true":"false";else if(typeof D==="function"){const w=D.toString();M+=!w.includes("native code ")?"__fn()":w}else console.info("I DONT KNOW",typeof D);return[M,j]}static formatUrl(D){return D.replace(location.protocol+"//","").replace(location.hostname,"")}static formatSize(D){if(D===0)return"0";let E=D.toString();const H=(M,j)=>{if(D>M)E=`${(D/M).toFixed(2)} ${j}`};return E=`${D} B`,H(1000,"KB"),H(1e6,"MB"),H(1e9,"GB"),E}}class q{createdAt;autohideModifier=0;container;element;#D=null;#H=null;#M=null;#E=null;constructor(D,...E){this.createdAt=Date.now(),this.container=document.createElement("div"),this.element=document.createElement("div"),this.container.appendChild(this.element),this.setBannerStyle(),this.setLogStyle(D),this.setText(D,...E)}changeStyle(D){this.setLogStyle(D)}addText(...D){this.element.innerHTML+=" "+this.generateText(...D)}generateText(...D){let E=[];for(let H of D){const M=L.formatData(H);E.push(M[0])}return E.join(" ")}setText(D,...E){let H=[L.getCurrentTime(),this.generateText(...E)];this.element.innerHTML=H.join(" ")}setBannerStyle(){L.setStyle(this.container,{display:"flex",flexDirection:"column",width:"fit-content",padding:"0px 8px",borderRadius:"2px"}),L.setStyle(this.element,{display:"flex",alignItems:"center",flexWrap:"wrap",width:"fit-content",transition:"all 0.2s ease-out",gap:"4px"})}setLogStyle(D){let E={};switch(D){case"web-success":E.background="#33aa11";break;case"web-pending":E.background="#4411aa";break;case"log":E.background="#4444cc";break;case"debug":E.background="#777777";break;case"info":E.background="#ffffff",E.color="#000000";break;case"warn":E.background="#998822";break;case"error":case"web-error":E.background="#991111";break;default:break}L.setStyle(this.element,E),L.setStyle(this.container,E)}setStackTrace(D){const E=document.createElement("div");L.setStyle(E,{marginLeft:"10px",fontWeight:"bold"});for(let H of D)E.innerHTML+=`<div>\u2022 ${H}</div>`;this.container.appendChild(E)}setWebProgress(D,E,H){if(this.#M.style.width=D.toString().padStart(3,"0")+"%",this.#H.innerHTML=D+"%",E&&H)if(D===100)this.#E.innerHTML=`(${L.formatSize(E)})`;else this.#E.innerHTML=`(${L.formatSize(H)} / ${L.formatSize(E)})`}createWebProgressDiv(){this.#D=document.createElement("div"),L.setStyle(this.#D,{display:"flex",alignItems:"center",gap:"5px"});const D=document.createElement("div");D.innerHTML="50";const E=document.createElement("div");L.setStyle(E,{display:"block",backgroundColor:"",border:"1px solid white",height:"8px",width:"100px",borderRadius:"2px"});const H=document.createElement("div");L.setStyle(H,{height:"inherit",width:"0px",backgroundColor:"white",transition:"width 0.2s linear",borderRadius:"inherit"}),E.appendChild(H),this.#D.appendChild(E),this.#D.appendChild(D),this.#E=document.createElement("div"),this.#D.appendChild(this.#E),this.#H=D,this.#M=H,this.element.appendChild(this.#D)}}class G{isMouseOver=!1;containerElement=void 0;messages=[];options={maxMessage:100,autohideDelay:10,position:"BOTTOM-LEFT",offsetX:20,offsetY:40,maxHeight:200,maxWidth:0};constructor(){this.show(),this.overrideConsole("log"),this.overrideConsole("debug"),this.overrideConsole("info"),this.overrideConsole("warn"),this.overrideConsole("error"),window.onerror=(D,E,H,M,j)=>{this.showLog("error",j?.message,j?.cause,j?.stack)},this.overrideFetch(),this.overrideXmlHttpRequest()}setOptions(D){this.options={...this.options,...D},document.body.removeChild(this.containerElement),this.show()}show(){this.containerElement=this.createContainerElement()}overrideFetch(){const D=this;window.fetch=new Proxy(window.fetch,{async apply(E,H,M){const j=M[0],w=D.showLog("web-pending",j.method,L.formatUrl(j.url)),X=Date.now();let $=await E.apply(H,M);const F=Date.now()-X;if(!$.ok){const I=await $.clone().text();w.changeStyle("web-error"),w.addText(`[${$.status} ${$.statusText}]`,`[${F}ms]`,I)}else w.changeStyle("web-success"),w.addText(`[${$.status}]`,`[${F}ms]`);return $}})}overrideXmlHttpRequest(){const D=this;XMLHttpRequest.prototype.open=new Proxy(XMLHttpRequest.prototype.open,{apply(E,H,M){E.apply(H,M);const j=D.showLog("web-pending",M[0],L.formatUrl(M[1]));if(M[0]==="POST")j.createWebProgressDiv(),H.upload.addEventListener("progress",(w)=>{j.setWebProgress(Math.round(w.loaded/w.total*100),w.total,w.loaded)})}})}overrideConsole(D){const E=this;console[D]=new Proxy(console[D],{apply(H,M,j){H.apply(M,j);const w=E.showLog(D,...j);if(D==="error"){const X=Error().stack?.split("\n").filter(($)=>$)??[];w.setStackTrace(X)}}})}createContainerElement(){const D=document.createElement("div");D.id="console-overlay-container";const E={"BOTTOM-LEFT":{bottom:this.options.offsetY+"px",left:this.options.offsetX+"px",flexDirection:"column-reverse"},"TOP-LEFT":{top:this.options.offsetY+"px",left:this.options.offsetX+"px",flexDirection:"column"},"BOTTOM-RIGHT":{bottom:this.options.offsetY+"px",right:this.options.offsetX+"px",flexDirection:"column-reverse"},"TOP-RIGHT":{top:this.options.offsetY+"px",right:this.options.offsetX+"px",flexDirection:"column"}};return L.setStyle(D,{position:"absolute",display:"flex",gap:"2px",borderRadius:"5px",maxHeight:this.options.maxHeight+"px",overflow:"auto",zIndex:"30000",maxWidth:this.options.maxWidth>10?`${this.options.maxWidth}px`:`calc(100vw - ${this.options.offsetX*2}px)`,opacity:"0.65",fontSize:"0.65rem",fontFamily:"monospace",...E[this.options.position]}),D.addEventListener("mouseenter",()=>{this.isMouseOver=!0}),D.addEventListener("mouseleave",()=>{this.isMouseOver=!1}),this.autohide(),document.body.appendChild(D),D}autohide(){setInterval(()=>{const D=Date.now();for(let E of this.messages)try{if(this.isMouseOver){E.autohideModifier+=1000;continue}if(D-(E.createdAt+E.autohideModifier)>this.options.autohideDelay*1000)this.containerElement.removeChild(E.container),this.messages=this.messages.filter((H)=>H!==E)}catch(H){}},1000)}showLog(D,...E){const H=new q(D,...E);if(this.containerElement.insertBefore(H.container,this.containerElement.firstChild),this.messages.push(H),this.messages.length>=this.options.maxMessage)this.messages=this.messages.slice(-this.options.maxMessage);return H}}Object.assign(window,{overlayConsole:new G});
